#!/usr/bin/python3

import os
from os import path
import subprocess

def main():

    with open(".gitignore", "a+") as f:
        if '.bin/' not in f.read():
            f.write("\n.bin/")

    if(not path.isdir(".bin/")):
        os.mkdir(".bin/")
    else:
        raise Exception("Setup Script already run!")

    script = """#!/usr/bin/python3
import argparse
import subprocess
import os
from os import path

def build():
    if(not path.isdir("../build/")):
        os.mkdir("../build/")
    os.chdir("../build/")
    command = "cmake .. && make -j16"
    subprocess.run(command.split())

def run():
    if(not path.isdir("../build/")):
        raise Exception("You haven't built the project. Try mw 'build'")
    os.chdir("../build/")
    if(not path.exists("MalwareDetector")):
        raise Exception("You haven't built the project. Try mw 'build'")
    subprocess.run("./MalwareDetector")
    
def main():
    parser = argparse.ArgumentParser("General purpose malware detector tool to build and run the project")
    parser.add_argument("build", action="store_true")
    parser.add_argument("run", action="store_true")
    args = parser.parse_args()

    if(args.build):
        build()
    elif(args.run):
        run()

main()"""
    with open(".bin/mw.py", "a+") as f:
        f.write(script)
    subprocess.run("chmod u+x .bin/mw.py".split())
    subprocess.run("mv .bin/mw.py .bin/mw".split())
    subprocess.run("export PATH=$PATH:.bin/".split())

main()


