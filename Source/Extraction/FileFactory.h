#pragma once

#include "IFile.h"
#include "PEFiles/PEFile.h"
#include <utility>
#include <memory>

namespace Extractor
{
    //a bit of a modification on the typical factory DP. This factory produces many extractors. It can be reused and creates one object per makeExtractor() call
    class FileFactory
    {
        public:
            FileFactory() {}

            std::shared_ptr<IFile> makeFile(FileDesc& desc)
            {
                std::pair<std::shared_ptr<std::ifstream>, filetype> fileType = checkFiletype(desc.fileName);
                if(fileType.second == PE32)
                    return std::make_shared<PE::PEFile32>(PE::PEFile32(fileType.first, desc));
                else if(fileType.second == PE32_PLUS)
                    return std::make_shared<PE::PEFile64>(PE::PEFile64(fileType.first, desc));
                else
                    return nullptr;
            }

            std::unique_ptr<IFile> makeFile(filetype type)
            {

                if(type == PE32)
                    return std::make_unique<PE::PEFile32>();
                else if(type == PE32_PLUS)
                    return std::make_unique<PE::PEFile64>();
                else
                    return nullptr;
            }

        private:
            std::pair<std::unique_ptr<std::ifstream>, filetype> checkFiletype(std::string path);
    };
}