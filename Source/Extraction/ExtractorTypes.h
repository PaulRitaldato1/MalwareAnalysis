#pragma once
#include <unordered_map>
#include <string>
#include <iostream>
#include <vector>

namespace Extractor
{
    
    //use to set flags in FeatureMask
    enum FeatureOpt
    {
        NUM_EXE_SECTIONS = 1 << 0,
        VIRTUAL_RAW_RATIO = 1 << 1,
        NGRAMS = 1 << 2,
        //TEXT_SIZE = 1 << 3,
        NUM_SECTIONS = 1 << 3,
        FUNCTION_SEARCH = 1 << 4
    };

    //Use with FeatureOpt to decide what features to extract. Defaults to everything. Standard bit field
    struct FeatureMask
    {
        //default mask is for all features
        FeatureMask()
        { 
            mask = 0;
            mask |= ~mask;
        }

        FeatureMask(unsigned char options)
        {
            mask = options;
        }

        FeatureMask(const FeatureMask& src) { mask = src.mask; }
        unsigned char mask;
    };

    //used to provide FileFactory with a set of types it is allowed to return
    enum filetype
    {
        PE32,
        PE32_PLUS,
        ELF,
        UNKNOWN
    };

    typedef std::string nGram;

    //A feature set represents all features extracted from one file
    struct FeatureSet
    {
        std::uint16_t numSections;
        std::uint16_t numExeSections;
        std::uint16_t virtualSize;
        float virtualTextSizeRatio;
        std::vector<bool> functions;
        std::size_t fileHash;
        std::unordered_map<std::string, nGram> nGrams; //key: hash of string, data: nGram as a string
        std::string filename;
        bool isMalicious;
    };

    //description of a directory 
    struct DirectoryDesc
    {
        std::string path;
        FeatureMask mask;
        bool isMalicious;
    };

    //used to pass around contents of a file BEFORE features are extracted
    struct FileDesc : public DirectoryDesc
    {
        FileDesc() {}
        FileDesc(std::string fileName) : 
            fileName(fileName)
            {}

        //copy contstructor
        FileDesc(const FileDesc& src) {fileName = src.fileName;}
        std::string fileName;
    };
}